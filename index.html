<!doctype html>
<html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>URL Shortener</title>
<body>
<h3>URL Shortener</h3>

<form id="f">
  <input id="u" placeholder="https://example.com" required><br>
  <input id="c" placeholder="Custom name (optional)"><br>
  <input id="t" placeholder="Title (optional)"><br>
  <button type="submit">Shorten</button>
</form>
<a href="url">stats</a>

<p id="o"></p>
<p id="err" style="color:red"></p>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
  import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

  // ✅ তোমার নতুন Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyAHWskypzeWEHDqfSB6UyViji90LKt4Wt0",
    authDomain: "my-new-shorurl.firebaseapp.com",
    databaseURL: "https://my-new-shorurl-default-rtdb.firebaseio.com/",
    projectId: "my-new-shorurl",
    storageBucket: "my-new-shorurl.firebasestorage.app",
    messagingSenderId: "974476613807",
    appId: "1:974476613807:web:7f2f35b4d9691bb69b1c5a",
    measurementId: "G-8ZDY26JDFQ"
  };

  // ✅ Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Random short code generator
  const random = n => [...Array(n)].map(()=>"ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789"[Math.random()*58|0]).join("");
  const exists = async id => (await get(child(ref(db),"urls/"+id))).exists();

  // Form handler
  f.onsubmit = async e => {
    e.preventDefault();
    err.textContent = "";
    o.textContent = "";

    let url = u.value.trim();
    if (!/^https?:\/\//i.test(url)) url = "https://" + url;

    let id = c.value.trim() || random(6);
    if (await exists(id)) { err.textContent = "This custom name already exists!"; return; }

    await set(ref(db, "urls/" + id), {
      longUrl: url,
      title: t.value.trim(),
      createdAt: Date.now()
    });

    const short = location.origin + "/redirect.html?id=" + id;
    o.innerHTML = `<input value="${short}" id="x" size="35">
                   <button onclick="navigator.clipboard.writeText(x.value)">Copy</button>`;
  };
</script>
</body>
</html>
